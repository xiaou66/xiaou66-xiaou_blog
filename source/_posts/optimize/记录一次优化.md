---
title: 记录一次优化
date: 2022/05/18 12:47:41
math: true
categories:
  - [optimize]
tags:
  - [java]
---
# 记录一次优化

## MySQL IO 操作
> MySQL 使用在单表操作时短而快的查询连接，如果使用关联多张表反而出现速度慢的情况, 在数据库可用连接多的情况建议拆成单挑 SQL 语句执行。

## 一个接口过慢可以通过下面方式分析

1. 系统中存不存在慢 SQL
2. 分析 SQL 数量，在循环中的查询可以的情况下就给它移到循环的外部

## 使用工具

1. [Arthas](https://arthas.aliyun.com/doc/) 阿里出品一款分析工具
    - 使用分析工具可以快速找到目前慢的方法追踪其接口链路。

## 找到慢的原因后通用的解决方案

### SQL 问题
1. 使用 `EXPLAIN`  分析是否使用了索引
2. 使用 `EXPLAIN FORMAT='tree'` 分析执行计算 - 这命令是 `MySQL 8.0`
    - 如果版本低于 `8.0` 可以使用 `EXPAIN FORMAT = "JSON"` 

### 方法问题
1. 是否存在实时统计的数据
    -  判断数据的实时性需求是否高, 如果不要可以采用 `离线统计`
2. 是否可以拆成多个接口

### 本次优化出现问题以后需要注意:

1. 字符集一定要一致
    - 这次出现测试环境字符集一致到生产环境的时候发现有个字段的字符集不一致导致没有走缩影。

2. 在使用 `Collectors.toMap()` 方法时候一定要填写第三个参数，不管有没有重复的 key 一定确定解决 key 冲突的策略